### 第二章 简单的HTTP协议

- HTTP协议和TCP/IP协议族内的其他众多的协议相同，用于客户端和服务器之间的通信。
- 请求访问文本或图像等资源的一端称为客户端，而提供资源响应的一端称为服务器端。

---

HTTP协议规定，请求从客户端发出，最后服务器端响应该请求并返回。换句话说，肯定是**先从客户端开始建立通信的**，服务器端在没有接收到请求之前不会发送响应。

一个请求报文的内容：

```http
GET /index.htm HTTP/1.1
Host: hackr.jp
```
GET表示请求访问服务器的类型，称为方法（method）。随后的字符串/index.htm指明了请求访问的资源对象，也叫做请求URI（request-URI）。最后的HTTP/1.1，即HTTP的版本号，用来提示客户端使用的HTTP协议功能。

综合来看，这段请求内容的意思是：请求访问某台HTTP服务器上的/index.htm页面资源。

响应报文：

```http
HTTP/1.1 200 OK
Date: Tue, 10 Jul 2012 06:50:15 GMT
Content-Length: 362
Content-Type: text/html

<html>
……
```
HTTP/1.1表示服务器对应的HTTP版本。紧挨着的200 OK表示请求的处理结果的状态码（status code）和原因短语（reason-phrase）。
下一行显示了创建响应的日期时间，是首部字段（header field）内的一个属性。
接着以一空行分隔，之后的内容称为资源实体的主体（entity body）。

---

HTTP是一种**不保存状态，即无状态（stateless）协议**。HTTP协议自身不对请求和响应之间的通信状态进行保存。也就是说在HTTP这个级别，协议对于发送过的请求或响应都不做持久化处理。

这是为了更快地处理大量事务，确保协议的可伸缩性，而特意把HTTP协议设计成如此简单的。

HTTP/1.1虽然是无状态协议，但为了实现期望的保持状态功能，于是引入了Cookie技术。

---

HTTP协议使用URI定位互联网上的资源。正是因为URI的特定功能，在互联网上任意位置的资源都能访问到。

---

向请求URI指定的资源发送请求报文时，采用称为方法的命令。方法的作用在于，可以指定请求的资源按期望产生某种行为。

- GET方法用来请求访问已被URI识别的资源。
- POST方法用来传输实体的主体。
- PUT方法用来传输文件。
- HEAD方法获得报文首部
- DELETE方法用来删除文件
- OPTIONS方法用来查询针对请求URI指定的资源支持的方法
- TRACE方法是让Web服务器端将之前的请求通信环回给客户端的方法。（追踪路径）
- CONNECT方法要求在与代理服务器通信时建立隧道，实现用隧道协议进行TCP通信。

---

持久连接节省通信量

持久连接的特点是，只要任意一端没有明确提出断开连接，则保持TCP连接状态。

持久连接的好处在于减少了TCP连接的重复建立和断开所造成的额外开销，减轻了服务器端的负载。另外，减少开销的那部分时间，使HTTP请求和响应能够更早地结束，这样Web页面的显示速度也就相应提高了。

在HTTP/1.1中，所有的连接默认都是持久连接。

持久连接使得多数请求以管线化（pipelining）方式发送成为可能。从前发送请求后需等待并收到响应，才能发送下一个请求。管线化技术出现后，不用等待响应亦可直接发送下一个请求。

---

**Cookie技术**通过在请求和响应报文中写入Cookie信息来控制客户端的状态。

HTTP请求报文和响应报文的内容如下：

①请求报文（没有Cookie信息的状态）
```http
GET /reader/ HTTP/1.1
Host: hackr.jp 
＊首部字段内没有Cookie的相关信息
```

②响应报文（服务器端生成Cookie信息）
```http
HTTP/1.1200 OK
Date: Thu, 12 Jul 2012 07:12:20 GMT
Server: Apache
＜Set-Cookie: sid=1342077140226724; path=/; expires=Wed, =>
10-Oct-12 07:12:20 GMT＞
Content-Type: text/plain; charset=UTF-8
```

③请求报文（自动发送保存着的Cookie信息）
```http
GET /image/ HTTP/1.1
Host: hackr.jp
Cookie: sid=1342077140226724
```

